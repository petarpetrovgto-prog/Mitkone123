<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Range Trainer vT5</title>
<style>
  :root{
    --bg:#0b0f14; --border:#223047; --text:#e7ecf3;
    --FOLD:#f4f6fa; --L-F-F:#a7e8a7; --L-C-F:#155d15; --L-C-AI:#bcdcf3; --L-R-AI:#0b3a94;
    --MR-F-F:#ffe27a; --MR-C-AI:#7b4a2a; --MR-4B-AI:#e44747; --SHOVE:#6d4b8e;
    --ok:#1f9d55; --err:#d64545;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.35 -apple-system,system-ui,Segoe UI,Roboto,Arial}

  .top{position:sticky;top:0;z-index:30;display:flex;justify-content:space-between;align-items:center;
       padding:6px 8px;background:#101827;border-bottom:1px solid var(--border)}
  .chip{padding:3px 8px;border:1px solid var(--border);border-radius:999px;background:#0f1624;font-size:12px}
  .btn{border:1px solid var(--border);background:#0f1624;color:var(--text);border-radius:12px;
       padding:10px 14px;font-weight:800;cursor:pointer}

  .wrap{max-width:1100px;margin:0 auto;padding:10px}
  .grid{display:grid;gap:10px}
  @media(min-width:980px){.grid{grid-template-columns:1.1fr 0.9fr}}
  .card{border:1px solid var(--border);background:#0f1624;border-radius:14px;padding:12px}
  .card h3{margin:0 0 8px;font-size:16px}

  .qTop{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .qHand{font-size:26px;font-weight:900}

  /* –¥–µ–π—Å—Ç–≤–∏—è: –æ—Ç—á–µ—Ç–ª–∏–≤–∏ –±—É—Ç–æ–Ω–∏ */
  .actionsGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .actBtn{
    position:relative;border:2px solid rgba(0,0,0,.18);border-radius:13px;
    padding:16px 10px;font-size:16px;font-weight:1000;letter-spacing:.3px;
    color:#000; box-shadow:0 4px 14px rgba(0,0,0,.25);
    transform:translateY(0); transition:transform .06s ease, filter .06s ease;
  }
  .actBtn:active{transform:translateY(1px); filter:brightness(.96)}
  .tag{position:absolute;right:8px;top:6px;font-size:11px;opacity:.7}

  /* keypad (–∑–∞ PUSH) */
  .disp{margin:4px 0 8px;border:1px solid var(--border);background:#0b1220;border-radius:10px;padding:10px;font-weight:900;text-align:center}
  .keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .key{border:1px solid var(--border);background:#111a2b;border-radius:12px;padding:16px 0;font-weight:900;font-size:20px}
  .key.wide{grid-column:span 2}

  .feedback{margin-top:10px;font-weight:900}
  .ok{color:var(--ok)} .err{color:var(--err)}
  .resRow{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;
          border:1px dashed #2a3b58;border-radius:10px;margin-top:8px}
  .val{font-weight:900;padding:6px 8px;border-radius:8px;min-width:96px;text-align:center}

  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#0f1624;
         border-radius:999px;padding:6px 10px;font-weight:800;cursor:pointer}
  .badge input{accent-color:#4da3ff}
  .mini{font-size:12px;opacity:.8}
  .sep{height:1px;background:#223047;margin:10px 0}

  /* –º–æ–¥–∞–ª–∏ */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:60;align-items:center;justify-content:center;padding:16px}
  .overlay.show{display:flex}
  .box{width:100%;max-width:680px;background:#0f1520;border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .boxHead{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#101827;border-bottom:1px solid var(--border)}
  .boxBody{padding:10px 12px}
  .boxFoot{display:flex;gap:8px;justify-content:space-between;padding:10px 12px;border-top:1px solid var(--border);background:#0f1520}
  textarea{width:100%;min-height:260px;background:#0b1220;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px;font:14px/1.35 ui-monospace}
</style>
</head>
<body>
<div class="top">
  <div>
    <span class="chip">Q: <b id="qCount">0</b></span>
    <span class="chip">‚úî: <b id="qRight">0</b></span>
    <span class="chip">üî•: <b id="streak">0</b></span>
  </div>
  <div>
    <button class="btn" id="btnEdit">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
    <button class="btn" id="btnData">Import/Export</button>
  </div>
</div>

<div class="wrap grid">
  <!-- QUIZ -->
  <div class="card">
    <h3>–¢–µ—Å—Ç</h3>
    <div class="qTop">
      <div class="qHand" id="qHand">‚Äî</div>
      <div id="qStack">–°—Ç–∞–∫: ‚Äî</div>
      <div id="qPos">–ü–æ–∑–∏—Ü–∏—è: ‚Äî</div>
    </div>

    <div id="ansArea"></div>

    <div id="feedback" class="feedback"></div>
    <div id="correctRow" class="resRow" style="display:none">
      <div>–ü—Ä–∞–≤–∏–ª–µ–Ω:</div>
      <div id="correctVal" class="val">‚Äî</div>
    </div>

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="btnNext" class="btn" style="flex:1;font-weight:900">–°–ª–µ–¥–≤–∞—â</button>
      <button id="btnCheck" class="btn" style="flex:1;font-weight:900">–ü—Ä–æ–≤–µ—Ä–∏</button>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="card">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

    <div class="mini">–ü–æ–∑–∏—Ü–∏–∏ –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞:</div>
    <div id="posFilters" class="row"></div>

    <div class="sep"></div>

    <div class="mini">–°—Ç–∞–∫ –¥–∏–∞–ø–∞–∑–æ–Ω–∏:</div>
    <div id="stkFilters" class="row"></div>

    <div class="sep"></div>

    <div class="row">
      <button id="btnStart" class="btn" style="flex:1;font-weight:900">–°—Ç–∞—Ä—Ç / –†–µ—Å—Ç–∞—Ä—Ç</button>
      <button id="btnResetScore" class="btn" style="flex:1;font-weight:900">–ù—É–ª–∏—Ä–∞–π —Ä–µ–∑—É–ª—Ç–∞—Ç</button>
      <button id="btnClearAll" class="btn" style="flex:1;font-weight:900">–ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏</button>
    </div>
  </div>
</div>

<!-- EDITOR -->
<div id="editModal" class="overlay">
  <div class="box">
    <div class="boxHead">
      <div><b>–†–µ–¥–∞–∫—Ç–æ—Ä</b> <span id="editMeta" class="mini"></span></div>
      <button id="editClose" class="btn">X</button>
    </div>
    <div class="boxBody">
      <div class="row">
        <select id="editPos" class="btn" style="flex:1"></select>
        <select id="editStk" class="btn" style="flex:1"></select>
      </div>
      <div class="row mini">–§–æ—Ä–º–∞—Ç: <code>HAND = ACTION</code> / <code>default = ACTION</code>; –∑–∞ PUSH ‚Äî —á–∏—Å–ª–æ.</div>
      <textarea id="editArea" placeholder="AJo = L-C-AI&#10;default = Fold"></textarea>
    </div>
    <div class="boxFoot">
      <button id="editClear" class="btn">–ò–∑—á–∏—Å—Ç–∏ —Ç–∞–∑–∏ –∫–ª–µ—Ç–∫–∞</button>
      <div><button id="editSave" class="btn">–ó–∞–ø–∞–∑–∏</button></div>
    </div>
  </div>
</div>

<!-- DATA IO -->
<div id="dataModal" class="overlay">
  <div class="box">
    <div class="boxHead">
      <div><b>Import / Export</b></div>
      <button id="dataClose" class="btn">X</button>
    </div>
    <div class="boxBody">
      <textarea id="dataArea" placeholder='{"HUSB||0‚Äì4":{"raw":"..."},"BBvsSB_L||13+":{"raw":"..."}}'></textarea>
    </div>
    <div class="boxFoot">
      <button id="dataImport" class="btn">–ò–º–ø–æ—Ä—Ç</button>
      <button id="dataExport" class="btn">–ï–∫—Å–ø–æ—Ä—Ç</button>
    </div>
  </div>
</div>

<script>
(function(){
  // –¶–≤–µ—Ç–æ–≤–µ/–¥–µ–π—Å—Ç–≤–∏—è
  const COLORS={
    "Fold":"var(--FOLD)","L-F-F":"var(--L-F-F)","L-C-F":"var(--L-C-F)","L-C-AI":"var(--L-C-AI)","L-R-AI":"var(--L-R-AI)",
    "MR-F-F":"var(--MR-F-F)","MR-C-AI":"var(--MR-C-AI)","MR-4B-AI":"var(--MR-4B-AI)","Shove":"var(--SHOVE)"
  };
  const ACTIONS=Object.keys(COLORS);
  const isPushPos = p => /PUSH/i.test(p);

  // –ü–æ–∑–∏—Ü–∏–∏/—Å—Ç–∞–∫–æ–≤–µ
  const POS_LIST=["HUSB","BU","HUBB_L","HUBB_MR","HUBBv_PUSH","SBvsBU","SBvsBU_PUSH","SBvsBB","BBvsBU_MR","BBvsBU_PUSH","BBvsSB_L","BBvsSB_MR","BBvsSB_PUSH"];
  const STKS=["0‚Äì4","4‚Äì7","7‚Äì10","10‚Äì13","13+"];

  // DB
  let DB=JSON.parse(localStorage.getItem("qt_trainer_v5")||"{}");
  const save=()=>localStorage.setItem("qt_trainer_v5",JSON.stringify(DB));
  const k=(p,r)=>p+"||"+r, get=(p,r)=>DB[k(p,r)]?.raw||"", set=(p,r,raw)=>{DB[k(p,r)]={raw};save();};

  // –°—ä—Å—Ç–æ—è–Ω–∏–µ
  let curQ=null, count=0, right=0, streak=0;
  let numBuf=""; // –∑–∞ push

  // –§–∏–ª—Ç—Ä–∏ UI
  function buildFilters(){
    const posC=document.getElementById("posFilters"); posC.innerHTML="";
    POS_LIST.forEach(p=>{
      const lab=document.createElement("label"); lab.className="badge";
      const cb=document.createElement("input"); cb.type="checkbox"; cb.checked=true; cb.dataset.pos=p;
      lab.appendChild(cb); lab.append(" "+p); posC.appendChild(lab);
    });
    const stkC=document.getElementById("stkFilters"); stkC.innerHTML="";
    STKS.forEach(s=>{
      const lab=document.createElement("label"); lab.className="badge";
      const cb=document.createElement("input"); cb.type="checkbox"; cb.checked=true; cb.dataset.stk=s;
      lab.appendChild(cb); lab.append(" "+s); stkC.appendChild(lab);
    });
  }
  buildFilters();
  const getFilters=()=>({
    pos: Array.from(document.querySelectorAll('#posFilters input:checked')).map(x=>x.dataset.pos).concat().filter(Boolean) || POS_LIST.slice(),
    stk: Array.from(document.querySelectorAll('#stkFilters input:checked')).map(x=>x.dataset.stk).concat().filter(Boolean) || STKS.slice()
  });

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
  function askNew(){
    const sel=getFilters();
    const pos = (sel.pos.length? sel.pos : POS_LIST)[Math.floor(Math.random()* (sel.pos.length||POS_LIST.length))];
    const stk = (sel.stk.length? sel.stk : STKS)[Math.floor(Math.random()* (sel.stk.length||STKS.length))];
    const R=["A","K","Q","J","T","9","8","7","6","5","4","3","2"];
    const r1=R[Math.floor(Math.random()*R.length)], r2=R[Math.floor(Math.random()*R.length)];
    const hand = r1===r2? r1+r2 : r1+r2+(Math.random()<0.5?"s":"o");
    curQ={pos,stk,hand};
    numBuf="";
    document.getElementById("qHand").textContent=hand;
    document.getElementById("qStack").textContent="–°—Ç–∞–∫: "+stk;
    document.getElementById("qPos").textContent="–ü–æ–∑–∏—Ü–∏—è: "+pos;
    document.getElementById("feedback").textContent="";
    document.getElementById("correctRow").style.display="none";
    renderAnswerUI();
  }

  // –†–µ–Ω–¥–µ—Ä –Ω–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ
  function renderAnswerUI(){
    const a=document.getElementById("ansArea"); a.innerHTML="";
    if(isPushPos(curQ.pos)){
      // Keypad –∑–∞ —á–∏—Å–ª–∞
      const disp=document.createElement("div"); disp.className="disp"; disp.id="numDisp"; disp.textContent="–í—ä–≤–µ–¥–∏ —á–∏—Å–ª–æ";
      const grid=document.createElement("div"); grid.className="keypad";
      const keys=["7","8","9","4","5","6","1","2","3",".","0","‚Üê"];
      keys.forEach(k=>{
        const b=document.createElement("button"); b.className="key"; b.textContent=k;
        b.onclick=()=>keyPress(k);
        grid.appendChild(b);
      });
      a.appendChild(disp); a.appendChild(grid);
    }else{
      // –¶–≤–µ—Ç–Ω–∏ action –±—É—Ç–æ–Ω–∏
      const g=document.createElement("div"); g.className="actionsGrid";
      ACTIONS.forEach(act=>{
        const b=document.createElement("button");
        b.className="actBtn";
        b.style.background = `linear-gradient(180deg, ${COLORS[act]} 0%, ${COLORS[act]} 72%, rgba(0,0,0,.06) 100%)`;
        b.textContent=act;
        const t=document.createElement("span"); t.className="tag"; t.textContent=act.includes("AI")?"AI":"";
        b.appendChild(t);
        b.onclick=()=>checkAnswer(false, act);
        g.appendChild(b);
      });
      a.appendChild(g);
    }
  }
  function updateDisp(){ const d=document.getElementById("numDisp"); if(d) d.textContent = numBuf.length? numBuf : "–í—ä–≤–µ–¥–∏ —á–∏—Å–ª–æ"; }
  function keyPress(k){
    if(k==="‚Üê"){ numBuf=numBuf.slice(0,-1); updateDisp(); return; }
    if(k==="." && numBuf.includes(".")) return;
    if(numBuf.length>=6) return;
    numBuf += k; updateDisp();
  }

  // –û—Ü–µ–Ω–∫–∞
  function compute(pos,hand,stk){
    const raw=get(pos,stk); if(!raw) return {disp:"‚Äî", isNum:isPushPos(pos)};
    const lines=raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    let map={},def=null;
    lines.forEach(l=>{
      const [h,v]=l.split("=").map(x=>x.trim());
      if(v==null){def=h;} else if(/^default$/i.test(h)) def=v; else map[h.toUpperCase()]=v;
    });
    const disp = map[hand.toUpperCase()] || def || "‚Äî";
    return {disp, isNum:isPushPos(pos)};
  }

  function checkAnswer(showOnly=false, chosenAct=null){
    if(!curQ) return;
    const res=compute(curQ.pos,curQ.hand,curQ.stk);
    const fb=document.getElementById("feedback");
    const cRow=document.getElementById("correctRow");
    const cVal=document.getElementById("correctVal");

    if(res.disp==="‚Äî"){
      fb.textContent="–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ —Ç–∞–∑–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è."; fb.className="feedback";
      cRow.style.display="flex"; cVal.textContent="‚Äî"; cVal.style.background="#2a2f3c"; cVal.style.color="#fff";
      return;
    }

    if(!showOnly){
      count++;
      let ok=false;
      if(res.isNum){
        const ans=Number(numBuf), tgt=Number(res.disp);
        ok = Number.isFinite(ans) && Math.abs(ans-tgt)<=0.1;
      }else{
        ok = chosenAct!=null && chosenAct===res.disp;
      }
      if(ok){ right++; streak++; fb.textContent="–í–Ø–†–ù–û!"; fb.className="feedback ok"; }
      else  { streak=0; fb.textContent="–ì–†–ï–®–ù–û"; fb.className="feedback err"; }
      document.getElementById("qCount").textContent=count;
      document.getElementById("qRight").textContent=right;
      document.getElementById("streak").textContent=streak;
    }

    cRow.style.display="flex";
    cVal.textContent=res.disp;
    // —Ü–≤—è—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª–Ω–∏—è
    if(res.isNum){ cVal.style.background="rgba(0,0,0,.22)"; cVal.style.color="#fff"; }
    else { cVal.style.background=(COLORS[res.disp]||"#2a2f3c"); cVal.style.color="#000"; }
  }

  // –†–µ–¥–∞–∫—Ç–æ—Ä
  const editModal=document.getElementById("editModal");
  const editPos=document.getElementById("editPos");
  const editStk=document.getElementById("editStk");
  const editArea=document.getElementById("editArea");
  function openEditor(){
    editPos.innerHTML = POS_LIST.map(p=>`<option value="${p}">${p}</option>`).join("");
    editStk.innerHTML = STKS.map(s=>`<option value="${s}">${s}</option>`).join("");
    editArea.value = get(editPos.value, editStk.value) || "";
    document.getElementById("editMeta").textContent=`(${editPos.value} √ó ${editStk.value})`;
    editModal.classList.add("show");
  }
  document.getElementById("btnEdit").onclick=openEditor;
  document.getElementById("editClose").onclick=()=>editModal.classList.remove("show");
  editPos.addEventListener("change",()=>{editArea.value=get(editPos.value,editStk.value)||""; document.getElementById("editMeta").textContent=`(${editPos.value} √ó ${editStk.value})`;});
  editStk.addEventListener("change",()=>{editArea.value=get(editPos.value,editStk.value)||""; document.getElementById("editMeta").textContent=`(${editPos.value} √ó ${editStk.value})`;});
  document.getElementById("editSave").onclick=()=>{ set(editPos.value, editStk.value, editArea.value); editModal.classList.remove("show"); };
  document.getElementById("editClear").onclick=()=>{ if(confirm("–î–∞ –∏–∑—á–∏—Å—Ç—è —Ç–∞–∑–∏ –∫–ª–µ—Ç–∫–∞?")){ set(editPos.value, editStk.value, ""); editModal.classList.remove("show"); } };

  // Data IO
  const dataModal=document.getElementById("dataModal");
  const dataArea=document.getElementById("dataArea");
  document.getElementById("btnData").onclick=()=>{ dataArea.value=JSON.stringify(DB,null,2); dataModal.classList.add("show"); };
  document.getElementById("dataClose").onclick=()=>dataModal.classList.remove("show");
  document.getElementById("dataExport").onclick=()=>{ dataArea.value=JSON.stringify(DB,null,2); dataArea.focus(); dataArea.select(); };
  document.getElementById("dataImport").onclick=()=>{ try{ const obj=JSON.parse(dataArea.value); DB=obj; save(); alert("–ò–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–Ω–æ."); }catch(e){ alert("–ù–µ–≤–∞–ª–∏–¥–µ–Ω JSON."); } };

  // –ö–æ–Ω—Ç—Ä–æ–ª–∏
  document.getElementById("btnStart").onclick=()=>{count=right=streak=0; document.getElementById("qCount").textContent=0; document.getElementById("qRight").textContent=0; document.getElementById("streak").textContent=0; askNew();};
  document.getElementById("btnResetScore").onclick=()=>{count=right=streak=0; document.getElementById("qCount").textContent=0; document.getElementById("qRight").textContent=0; document.getElementById("streak").textContent=0;};
  document.getElementById("btnClearAll").onclick=()=>{ if(confirm("–ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –≤—ä–≤–µ–¥–µ–Ω–∏ –¥–∞–Ω–Ω–∏?")){ DB={}; save(); alert("–ò–∑—á–∏—Å—Ç–µ–Ω–æ."); } };

  document.getElementById("btnNext").onclick=askNew;
  document.getElementById("btnCheck").onclick=()=>checkAnswer(false);

  // –°—Ç–∞—Ä—Ç–æ–≤–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ (—Ä—ä—á–Ω–æ –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äû–°—Ç–∞—Ä—Ç / –†–µ—Å—Ç–∞—Ä—Ç‚Äú)
})();
</script>
</body>
</html>
