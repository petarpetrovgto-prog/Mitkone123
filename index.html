<!doctype html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Range Trainer vT3</title>
<style>
  :root{
    --bg:#0b0f14; --border:#223047; --text:#e7ecf3;
    --FOLD:#f4f6fa; --L-F-F:#a7e8a7; --L-C-F:#155d15; --L-C-AI:#bcdcf3; --L-R-AI:#0b3a94;
    --MR-F-F:#ffe27a; --MR-C-AI:#7b4a2a; --MR-4B-AI:#e44747; --SHOVE:#6d4b8e;
    --ok:#1f9d55; --err:#d64545;
  }
  body{margin:0;background:var(--bg);color:var(--text);font:16px/1.35 -apple-system,system-ui,Segoe UI,Roboto,Arial}
  .top{position:sticky;top:0;z-index:30;display:flex;justify-content:space-between;align-items:center;
       padding:6px 8px;background:#101827;border-bottom:1px solid var(--border)}
  .chip{padding:3px 8px;border:1px solid var(--border);border-radius:999px;background:#0f1624;font-size:12px}
  .btn{border:1px solid var(--border);background:#0f1624;color:var(--text);border-radius:12px;
       padding:10px 14px;font-weight:800;cursor:pointer}
  .btn.big{padding:12px 16px;font-size:18px}
  .wrap{max-width:1100px;margin:0 auto;padding:10px}
  .grid{display:grid;gap:10px}
  @media(min-width:980px){.grid{grid-template-columns:1.1fr 0.9fr}}
  .card{border:1px solid var(--border);background:#0f1624;border-radius:14px;padding:12px}
  .card h3{margin:0 0 8px;font-size:16px}
  .qTop{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .qHand{font-size:26px;font-weight:900}
  .actionsGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .actionsGrid .btn{padding:12px 8px;font-size:14px}
  .feedback{margin-top:10px;font-weight:900}
  .ok{color:var(--ok)} .err{color:var(--err)}
  .resRow{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;
          border:1px dashed #2a3b58;border-radius:10px;margin-top:8px}
  .val{font-weight:900;padding:6px 8px;border-radius:8px;min-width:96px;text-align:center}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}
  .badge{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);background:#0f1624;
         border-radius:999px;padding:6px 10px;font-weight:800;cursor:pointer}
  .badge input{accent-color:#4da3ff}
  .sep{height:1px;background:#223047;margin:10px 0}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;z-index:60;align-items:center;justify-content:center;padding:16px}
  .overlay.show{display:flex}
  .box{width:100%;max-width:680px;background:#0f1520;border:1px solid var(--border);border-radius:14px;overflow:hidden}
  .boxHead{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:#101827;border-bottom:1px solid var(--border)}
  .boxBody{padding:10px 12px}
  .boxFoot{display:flex;gap:8px;justify-content:space-between;padding:10px 12px;border-top:1px solid var(--border);background:#0f1520}
  textarea{width:100%;min-height:260px;background:#0b1220;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px;font:14px/1.35 ui-monospace}
  .mini{font-size:12px;opacity:.8}
</style>
</head>
<body>
<div class="top">
  <div>
    <span class="chip">Q: <b id="qCount">0</b></span>
    <span class="chip">‚úî: <b id="qRight">0</b></span>
    <span class="chip">üî•: <b id="streak">0</b></span>
  </div>
  <div>
    <button class="btn" id="btnEdit">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
    <button class="btn" id="btnData">Import/Export</button>
  </div>
</div>

<div class="wrap grid">
  <div class="card">
    <h3>–¢–µ—Å—Ç</h3>
    <div class="qTop">
      <div class="qHand" id="qHand">‚Äî</div>
      <div id="qStack">–°—Ç–∞–∫: ‚Äî</div>
      <div id="qPos">–ü–æ–∑–∏—Ü–∏—è: ‚Äî</div>
    </div>
    <div id="ansArea"></div>
    <div id="feedback" class="feedback"></div>
    <div id="correctRow" class="resRow" style="display:none">
      <div>–ü—Ä–∞–≤–∏–ª–µ–Ω:</div>
      <div id="correctVal" class="val">‚Äî</div>
    </div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="btnNext" class="btn big" style="flex:1">–°–ª–µ–¥–≤–∞—â</button>
      <button id="btnCheck" class="btn big" style="flex:1">–ü—Ä–æ–≤–µ—Ä–∏</button>
    </div>
  </div>

  <div class="card">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <div class="mini">–ü–æ–∑–∏—Ü–∏–∏:</div>
    <div id="posFilters" class="row"></div>
    <div class="sep"></div>
    <div class="mini">–°—Ç–∞–∫ –¥–∏–∞–ø–∞–∑–æ–Ω–∏:</div>
    <div id="stkFilters" class="row"></div>
    <div class="sep"></div>
    <div class="row">
      <button id="btnStart" class="btn big" style="flex:1">–°—Ç–∞—Ä—Ç / –†–µ—Å—Ç–∞—Ä—Ç</button>
      <button id="btnResetScore" class="btn" style="flex:1">–ù—É–ª–∏—Ä–∞–π —Ä–µ–∑—É–ª—Ç–∞—Ç</button>
      <button id="btnClearAll" class="btn" style="flex:1">–ò–∑—á–∏—Å—Ç–∏ –≤—Å–∏—á–∫–∏</button>
    </div>
  </div>
</div>

<script>
(function(){
  const COLORS={"Fold":"var(--FOLD)","L-F-F":"var(--L-F-F)","L-C-F":"var(--L-C-F)","L-C-AI":"var(--L-C-AI)","L-R-AI":"var(--L-R-AI)","MR-F-F":"var(--MR-F-F)","MR-C-AI":"var(--MR-C-AI)","MR-4B-AI":"var(--MR-4B-AI)","Shove":"var(--SHOVE)"};
  const ACTIONS=Object.keys(COLORS);
  const POS_LIST=["HUSB","BU","HUBB_L","HUBB_MR","HUBBv_PUSH","SBvsBU","SBvsBU_PUSH","SBvsBB","BBvsBU_MR","BBvsBU_PUSH","BBvsSB_L","BBvsSB_MR","BBvsSB_PUSH"];
  const STKS=["0‚Äì4","4‚Äì7","7‚Äì10","10‚Äì13","13+"];
  let DB=JSON.parse(localStorage.getItem("qt_trainer_v3")||"{}");
  const save=()=>localStorage.setItem("qt_trainer_v3",JSON.stringify(DB));
  const k=(p,r)=>p+"||"+r;
  const get=(p,r)=>DB[k(p,r)]?.raw||"";
  const set=(p,r,raw)=>{DB[k(p,r)]={raw};save();};

  let curQ=null, count=0, right=0, streak=0;

  function askNew(){
    const pos=POS_LIST[Math.floor(Math.random()*POS_LIST.length)];
    const stk=STKS[Math.floor(Math.random()*STKS.length)];
    const RANKS=["A","K","Q","J","T","9","8","7","6","5","4","3","2"];
    const r1=RANKS[Math.floor(Math.random()*RANKS.length)];
    const r2=RANKS[Math.floor(Math.random()*RANKS.length)];
    const hand=r1===r2? r1+r2: r1+r2+(Math.random()<0.5?"s":"o");
    curQ={pos,stk,hand};
    document.getElementById("qHand").textContent=hand;
    document.getElementById("qStack").textContent="–°—Ç–∞–∫: "+stk;
    document.getElementById("qPos").textContent="–ü–æ–∑–∏—Ü–∏—è: "+pos;
    renderAnswerUI();
  }

  function renderAnswerUI(){
    const a=document.getElementById("ansArea"); a.innerHTML="";
    const g=document.createElement("div"); g.className="actionsGrid";
    ACTIONS.forEach(act=>{
      const b=document.createElement("button"); b.className="btn"; b.style.background=COLORS[act]; b.textContent=act;
      b.onclick=()=>checkAnswer(false,act);
      g.appendChild(b);
    });
    a.appendChild(g);
  }

  function compute(pos,hand,stk){
    const raw=get(pos,stk); if(!raw)return {disp:"‚Äî"};
    const lines=raw.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
    let map={},def=null;
    lines.forEach(l=>{
      const [h,v]=l.split("=").map(x=>x.trim());
      if(!v){def=h;} else if(/^default$/i.test(h)) def=v; else map[h.toUpperCase()]=v;
    });
    return {disp:map[hand.toUpperCase()]||def||"‚Äî"};
  }

  function checkAnswer(showOnly=false,chosenAct=null){
    if(!curQ) return;
    const res=compute(curQ.pos,curQ.hand,curQ.stk);
    const fb=document.getElementById("feedback");
    const cRow=document.getElementById("correctRow"); const cVal=document.getElementById("correctVal");
    if(showOnly){fb.textContent="";} else {
      count++; const ok=chosenAct&&chosenAct===res.disp;
      if(ok){right++;streak++;fb.textContent="–í–Ø–†–ù–û!";fb.className="feedback ok";}else{streak=0;fb.textContent="–ì–†–ï–®–ù–û";fb.className="feedback err";}
      document.getElementById("qCount").textContent=count;
      document.getElementById("qRight").textContent=right;
      document.getElementById("streak").textContent=streak;
    }
    cRow.style.display="flex"; cVal.textContent=res.disp; cVal.style.background=COLORS[res.disp]||"#2a2f3c"; cVal.style.color="#000";
  }

  document.getElementById("btnNext").onclick=askNew;
  document.getElementById("btnCheck").onclick=()=>checkAnswer();
  document.getElementById("btnStart").onclick=()=>{count=right=streak=0;askNew();}
  document.getElementById("btnResetScore").onclick=()=>{count=right=streak=0;document.getElementById("qCount").textContent=0;document.getElementById("qRight").textContent=0;document.getElementById("streak").textContent=0;}
  document.getElementById("btnClearAll").onclick=()=>{if(confirm("–ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –¥–∞–Ω–Ω–∏?")){DB={};save();}}
})();
</script>
</body>
</html>
